version: 2.1
jobs:
  build:
    docker:
      - image: nvidia/cuda
    resource_class: gpu.medium
    steps:
      - run:
          command: apt-get -qq update && apt-get -qq -y install git
      - checkout
      - run:
          command: |
            apt-get -qq -y install curl bzip2 \
                && curl -sSL https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -o /tmp/miniconda.sh \
                && bash /tmp/miniconda.sh -bfp /usr/local \
                && conda install -y python=3
      - run:
          command: conda install pytorch torchvision -yc pytorch-nightly
      - run:
          command: python setup.py install
